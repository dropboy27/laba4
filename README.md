
# Лабораторная работа 4
## Вариант: Казино и Гуси

* **Цель:** Реализовать игровую симуляцию казино с пользовательскими коллекциями, наследованием классов и псевдослучайной моделью событий
* **Библиотеки:** *random*, *pytest*, *pytest-cov*
* **Допущения:**
  - Гуси не могут украсть больше денег, чем есть у игрока
  - Игрок не может сделать ставку больше своего баланса
  - Минимальная стоимость граблей для защиты от гусей - 50 монет
  - Атаки гусей влияют на здоровье игроков (случайный урон)
  - Крик HonkGoose снижает ловкость игрока
  - События выбираются случайно с равной вероятностью
  - При заданном seed симуляция воспроизводима
  - Игроки с балансом <= 0 могут покинуть казино
  - В данной работе надо было сделать коллеции на выбор, но, предполагая что надо сдеклавть все, я реализовал ChipCollection, которая не используется в ходе симуляции, но полносью работает и для нее реализованы тесты.

* **Чему я научился:**
    - Создание пользовательских коллекций через композицию
    - Реализация магических методов Python (`__iter__`, `__len__`, `__getitem__`, `__setitem__`, `__add__`)
    - Применение наследования для моделирования различного поведения сущностей
    - Работа с модулем `random` и управление воспроизводимостью через seed
    - Проектирование симуляции с текстовым логированием

### Алгоритм решения
  1. **Инициализация предметной модели:**
     - Создаются классы `Player` (игрок с балансом, здоровьем, ловкостью)
     - Базовый класс `Goose` и его подклассы: `WarGoose` (атакует), `HonkGoose` (кричит)
  
  2. **Создание пользовательских коллекций:**
     - **Списковые коллекции** (`PlayerCollection`, `GooseCollection`):
       - Реализованы через композицию с `list`
       - Поддерживают `__getitem__` (индексы и срезы), `__iter__`, `__len__`, `__delitem__`
       - Методы `append()`, `remove()`, `pop()`, `remove_by_name()`
     - **Словарная коллекция** (`CasinoBalance`):
       - Хранит балансы игроков: имя - баланс
       - Логирует изменения через переопределённый `__setitem__`
       - Методы `add_balance()`, `subtract_balance()` с валидацией

  3. **Создание класса Casino:**
     - Содержит коллекции игроков, гусей и балансов
     - Методы регистрации: `add_player()`, `add_goose()`
     - Методы событий: `gambling()`, `steal_money()`, `goose_attack()`, `goose_scream()`, `event_buy_rake()`
     - Метод `step()` выполняет одно случайное событие

  4. **Реализация функции симуляции `run_simulation()`:**
     - Принимает параметры: количество шагов и seed
     - Устанавливает seed через `random.seed()` для воспроизводимости
     - Инициализирует Casino с начальными игроками и гусями
     - В цикле выполняет `steps` шагов, вызывая `casino.step()`

  5. **Выполнение случайных событий на каждом шаге:**
     - `random.choice()` выбирает событие из списка:
       - **gambling** - игрок делает ставку, выигрывает или проигрывает
       - **steal_money** - случайный гусь крадёт деньги у случайного игрока
       - **goose_attack** - WarGoose атакует игрока (урон здоровью)
       - **goose_scream** - HonkGoose кричит на игрока (снижает ловкость)
       - **player_attack** - Player атакует гуся
       - **event_buy_rake** - игрок покупает грабли за 300 очков, и может либо ударить гуся с двойным уроном, либо ударить человека и украсть у него деньги

     - Каждое событие логируется в консоль с указанием участников и результата
     - Состояние коллекций обновляется (балансы, списки игроков/гусей)

  6. **Вывод результатов:**
     - После каждого события печатается текстовый лог
     - Отображаются изменения балансов, здоровья, состава участников
     - В конце симуляции можно вывести финальное состояние казино

## Интересные тест-кейсы
 - Попытка удаления игрока/гуся по несуществующему имени
 - Gambling с балансом 0 (игрок не может сделать ставку)
 - Steal_money когда у игрока недостаточно денег для кражи
 - Атака гуся когда игроков нет в казино
 - Симуляция с одинаковым seed даёт идентичные результаты
 - Покрытие тестами >= 80%

## Инструкция к использованию

### Установить зависимости
```

pip install pytest pytest-cov

```

### Запустить симуляцию
```

python -m src.main

```

### Запустить тесты
```

pytest tests/

```


## Структура проекта
```

.
├── src/
│   ├── classes/
│   │   ├── CasinoClass.py       \# Класс Casino с логикой симуляции
│   │   ├── PlayerClass.py       \# Класс Player
│   │   ├── GooseClass.py        \# Классы Goose, WarGoose, HonkGoose
│   │   └── ChipClass.py         \# Класс Chip
│   ├── game_collections/
│   │   ├── Player.py            \# PlayerCollection
│   │   ├── Goose.py             \# GooseCollection
│   │   ├── Chip.py              \# ChipCollection
│   │   └── CasinoBalance.py    \# CasinoBalance
│   ├── run_simulation_function.py  \# Функция run_simulation()
│   ├── main.py                  \# Точка входа
│   └── errors.py                \# Пользовательские исключения
├── tests/
│   ├── test_casino.py           \# Тесты класса Casino
│   ├── test_classes.py          \# Тесты Player, Goose, Chip
│   ├── test_collections.py      \# Тесты коллекций
│   └── test_simulation.py       \# Тесты симуляции
├── README.md
└── pyproject.toml

```
